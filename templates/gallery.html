{% extends "base.html" %}

{% block title %}Gallery - AgenticVisionForge{% endblock %}

{% block content %}
<div class="container mx-auto px-4">
  <!-- Header -->
  <div class="mb-6">
    <h2 class="text-2xl font-semibold text-gray-800 dark:text-gray-200">
      All Images
    </h2>
    <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">
      Browse and manage your generated images
    </p>
  </div>

  <!-- Filters and Controls -->
  <div class="mb-6 flex flex-wrap gap-4 items-center justify-between">
    <div class="flex flex-wrap gap-4 items-center">
      <!-- Search -->
      <div class="relative">
        <input
          type="text"
          id="searchBox"
          placeholder="Search images..."
          class="w-64 pl-10 pr-4 py-2 text-sm text-gray-900 bg-white
                 border border-gray-300 rounded-lg focus:ring-blue-500
                 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600
                 dark:placeholder-gray-400 dark:text-white"
        />
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
          <svg class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="none"
               stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5
                     a7 7 0 11-14 0 7 7 0 0114 0z" />
          </svg>
        </div>
      </div>

      <!-- Example Filter Dropdown (Optional) -->
      <!-- 
      <div class="relative" x-data="{ open: false }">
        <button
          @click="open = !open"
          class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border
                 border-gray-300 rounded-lg hover:bg-gray-50 focus:ring-4
                 focus:ring-blue-300 dark:bg-gray-700 dark:text-white
                 dark:border-gray-600 dark:hover:bg-gray-600"
        >
          Filter
        </button>
        <div
          x-show="open"
          @click.away="open = false"
          class="absolute z-10 mt-2 w-48 bg-white rounded-lg shadow-lg
                 dark:bg-gray-700"
        >
          <div class="p-2">
            ...
          </div>
        </div>
      </div>
      -->
    </div>

    <!-- Batch Actions (Optional) -->
    <!-- 
    <div class="flex gap-2">
      <button class="px-4 py-2 text-sm font-medium text-white bg-red-600
                     rounded-lg hover:bg-red-700 focus:ring-4
                     focus:ring-red-300">
        Delete Selected
      </button>
      <button class="px-4 py-2 text-sm font-medium text-white bg-blue-600
                     rounded-lg hover:bg-blue-700 focus:ring-4
                     focus:ring-blue-300">
        Download Selected
      </button>
    </div>
    -->
  </div>

  <!-- Image Grid -->
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"
       id="imageGrid">
    {% for image in images %}
    <div class="relative group image-card"
         data-goal="{{ image.goal|lower }}"
    >
      <div class="aspect-w-1 aspect-h-1 w-full overflow-hidden
                  rounded-lg bg-gray-200 dark:bg-gray-700">
        <img
          src="{{ image.url }}"
          alt="{{ image.goal }}"
          class="h-full w-full object-cover object-center
                 group-hover:opacity-75 transition-opacity duration-300"
        />
        <div class="absolute inset-0 bg-black bg-opacity-0
                    group-hover:bg-opacity-30 transition-opacity duration-300"></div>
        <div class="absolute inset-0 flex items-center justify-center
                    opacity-0 group-hover:opacity-100 transition-opacity duration-300">
          <button class="mx-1 p-2 text-white hover:text-blue-500"
                  onclick="viewFullImage('{{ image.url }}')">
            <svg class="w-6 h-6" fill="none" stroke="currentColor"
                 viewBox="0 0 24 24">
              <path stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 12a3 3 0 11-6 0
                       3 3 0 016 0z
                       M2.458 12C3.732 7.943 7.523 5
                       12 5c4.478 0 8.268 2.943
                       9.542 7-1.274 4.057-5.064 7
                       -9.542 7-4.477 0-8.268-2.943
                       -9.542-7z" />
            </svg>
          </button>
          <button class="mx-1 p-2 text-white hover:text-green-500"
                  onclick="downloadImage('{{ image.url }}', 'image.png')">
            <svg class="w-6 h-6" fill="none" stroke="currentColor"
                 viewBox="0 0 24 24">
              <path stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 16v1
                       a3 3 0 003 3h10
                       a3 3 0 003-3v-1
                       m-4-4l-4 4m0 0l-4-4
                       m4 4V4"/>
            </svg>
          </button>
        </div>
      </div>
      <div class="mt-2">
        <p class="text-sm font-medium text-gray-900 dark:text-gray-100 truncate">
          {{ image.goal }}
        </p>
        <p class="text-sm text-gray-500 dark:text-gray-400">
          {{ image.date }}
        </p>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- Empty State -->
  {% if not images %}
  <div class="text-center py-12">
    <svg class="mx-auto h-12 w-12 text-gray-400"
         fill="none" stroke="currentColor"
         viewBox="0 0 24 24">
      <path stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 16l4.586-4.586
               a2 2 0 012.828 0L16 16
               m-2-2l1.586-1.586
               a2 2 0 012.828 0L20 14
               m-6-6h.01M6 20h12a2
               2 0 002-2V6a2 2 0
               00-2-2H6a2 2 0 00-2
               2v12a2 2 0 002 2z" />
    </svg>
    <h3 class="mt-2 text-sm font-medium text-gray-900 dark:text-gray-100">
      No images
    </h3>
    <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
      Get started by generating your first image
    </p>
    <div class="mt-6">
      <a href="/generate"
         class="inline-flex items-center px-4 py-2 text-sm font-medium
                text-white bg-blue-600 rounded-lg hover:bg-blue-700
                focus:ring-4 focus:ring-blue-300">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor"
             viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round"
                stroke-width="2"
                d="M12 4v16m8-8H4"/>
        </svg>
        Generate Image
      </a>
    </div>
  </div>
  {% endif %}
</div>

<!-- Image Modal -->
<div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 hidden
                          justify-center items-center z-50">
  <div class="relative max-w-4xl mx-auto">
    <img id="modalImage" class="max-h-[90vh] max-w-[90vw] object-contain" />
    <button onclick="closeImageModal()"
            class="absolute top-4 right-4 text-white text-2xl">&times;</button>
  </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
// Fullscreen image view
function viewFullImage(url) {
  const modal = document.getElementById('imageModal');
  const img = document.getElementById('modalImage');
  img.src = url;
  modal.classList.remove('hidden');
  modal.classList.add('flex');
}
function closeImageModal() {
  const modal = document.getElementById('imageModal');
  modal.classList.add('hidden');
  modal.classList.remove('flex');
}

function downloadImage(url, filename) {
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
}

// Search / filter
document.getElementById('searchBox').addEventListener('input', function() {
  const searchTerm = this.value.toLowerCase();
  const imageCards = document.querySelectorAll('.image-card');
  imageCards.forEach(card => {
    const goalText = card.getAttribute('data-goal') || '';
    if (goalText.includes(searchTerm)) {
      card.classList.remove('hidden');
    } else {
      card.classList.add('hidden');
    }
  });
});
</script>
{% endblock %}
